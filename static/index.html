<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API Security Gateway - Admin Console</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary: #0071e3;
            --success: #34c759;
            --warning: #ff9500;
            --danger: #ff3b30;
            --bg-light: #f5f5f7;
            --bg-dark: #1d1d1f;
            --text-light: #86868b;
            --ease: cubic-bezier(0.28, 0.11, 0.32, 1);
            
            --font-headline: -apple-system, BlinkMacSystemFont, sans-serif;
            --font-body: -apple-system, BlinkMacSystemFont, sans-serif;
            
            --shadow-sm: 0 1px 3px rgba(0,0,0,0.1);
            --shadow-md: 0 4px 12px rgba(0,0,0,0.08);
            --shadow-lg: 0 8px 24px rgba(0,0,0,0.06);
            
            --radius-sm: 8px;
            --radius-md: 12px;
            --radius-lg: 18px;
        }

        body {
            font-family: var(--font-body);
            margin: 0;
            padding: 0;
            background: var(--bg-light);
            color: var(--text-light);
            transition: all 0.3s var(--ease);
            line-height: 1.5;
            -webkit-font-smoothing: antialiased;
            scroll-behavior: smooth;
        }

        body.dark {
            background: var(--bg-dark);
            color: #f1f5f9;
        }

        .layout {
            display: grid;
            grid-template-columns: 240px 1fr;
            min-height: 100vh;
        }

        .sidebar {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(10px);
            padding: 2rem 1.5rem;
            position: fixed;
            width: 280px;
            height: 100vh;
            overflow-y: auto;
            border-right: 1px solid rgba(0, 0, 0, 0.05);
            transition: all 0.3s var(--ease);
        }

        .dark .sidebar {
            background: #1f2937;
            border-color: #374151;
        }

        .main-content {
            margin-left: 240px;
            padding: 2rem;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .card {
            background: white;
            border-radius: 0.5rem;
            padding: 1.5rem;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .dark .card {
            background: #1f2937;
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .nav {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .nav-item {
            margin-bottom: 0.5rem;
        }

        .nav-link {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem;
            border-radius: 0.375rem;
            color: var(--text-light);
            text-decoration: none;
            transition: all 0.2s;
        }

        .nav-link:hover {
            background: #f1f5f9;
        }

        .nav-link.active {
            background: var(--primary);
            color: white;
        }

        .dark .nav-link:hover {
            background: #374151;
        }

        .button {
            padding: 0.5rem 1rem;
            border-radius: 0.375rem;
            border: none;
            font-size: 0.875rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .button-primary {
            background: var(--primary);
            color: white;
        }

        .view {
            display: none;
        }

        .view.active {
            display: block;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            color: var(--text-light);
            font-size: 0.875rem;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid #e2e8f0;
            border-radius: 0.375rem;
            font-size: 0.875rem;
            background: white;
        }

        .dark .form-group input,
        .dark .form-group select {
            background: #374151;
            border-color: #4b5563;
            color: #e2e8f0;
        }

        .logs {
            height: 300px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 0.875rem;
        }

        .log-entry {
            padding: 0.5rem;
            border-bottom: 1px solid #e2e8f0;
            display: flex;
            justify-content: space-between;
        }

        .dark .log-entry {
            border-color: #4b5563;
        }

        .metrics {
            display: grid;
            gap: 1rem;
        }

        .metric {
            padding: 1rem;
            background: #f8fafc;
            border-radius: 0.375rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .dark .metric {
            background: #374151;
        }

        .chart-container {
            position: relative;
            height: 200px;
            margin-top: 1rem;
        }

        .alert {
            padding: 0.75rem 1rem;
            border-radius: 0.375rem;
            margin-bottom: 1rem;
            animation: slideIn 0.3s ease;
        }

        .alert-success {
            background: #dcfce7;
            color: #166534;
        }

        .alert-error {
            background: #fee2e2;
            color: #991b1b;
        }

        @keyframes slideIn {
            from { transform: translateY(-10px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        @media (max-width: 768px) {
            .layout {
                grid-template-columns: 1fr;
            }
            .sidebar {
                display: none;
            }
            .main-content {
                margin-left: 0;
            }
        }
    </style>
</head>
<body>
    <div class="layout">
        <aside class="sidebar">
            <h1>Security Gateway</h1>
            <nav>
                <ul class="nav">
                    <li><a href="#dashboard" class="nav-link active" onclick="switchView('dashboard')">
                        <i class="fas fa-tachometer-alt"></i> Dashboard
                    </a></li>
                    <li><a href="#analytics" class="nav-link" onclick="switchView('analytics')">
                        <i class="fas fa-chart-line"></i> Analytics
                    </a></li>
                    <li><a href="#security" class="nav-link" onclick="switchView('security')">
                        <i class="fas fa-shield-alt"></i> Security
                    </a></li>
                    <li><a href="#logs" class="nav-link" onclick="switchView('logs')">
                        <i class="fas fa-list"></i> Logs
                    </a></li>
                    <li><a href="#settings" class="nav-link" onclick="switchView('settings')">
                        <i class="fas fa-cog"></i> Settings
                    </a></li>
                </ul>
            </nav>
        </aside>

        <main class="main-content">
            <header class="header">
                <div class="header-controls">
                    <button class="button button-primary" onclick="refreshData()">
                        <i class="fas fa-sync"></i> Refresh
                    </button>
                    <button class="button button-primary" onclick="toggleTheme()">
                        <i class="fas fa-moon"></i> Theme
                    </button>
                </div>
            </header>

            <!-- Dashboard View -->
            <div id="dashboard-view" class="view active">
                <div class="grid">
                    <div class="card">
                        <div class="card-header">
                            <h2>Gateway Status</h2>
                            <div class="status healthy">
                                <i class="fas fa-check-circle"></i> Healthy
                            </div>
                        </div>
                        <div class="metrics" id="gateway-metrics"></div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h2>System Resources</h2>
                        </div>
                        <div class="metrics" id="system-metrics"></div>
                        <div class="chart-container">
                            <canvas id="resourceChart"></canvas>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h2>Security Events</h2>
                        </div>
                        <div class="logs" id="security-logs"></div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h2>Traffic Analytics</h2>
                        </div>
                        <div class="chart-container">
                            <canvas id="trafficChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Analytics View -->
            <div id="analytics-view" class="view">
                <div class="grid">
                    <div class="card">
                        <div class="card-header">
                            <h2>Traffic Analysis</h2>
                        </div>
                        <div id="traffic-analytics"></div>
                    </div>
                </div>
            </div>

            <!-- Security View -->
            <div id="security-view" class="view">
                <div class="grid">
                    <div class="card">
                        <div class="card-header">
                            <h2>Threat Detection</h2>
                        </div>
                        <div id="threat-metrics"></div>
                    </div>
                </div>
            </div>

            <!-- Logs View -->
            <div id="logs-view" class="view">
                <div class="card">
                    <div class="card-header">
                        <h2>System Logs</h2>
                        <div class="controls">
                            <select id="log-level" onchange="filterLogs()">
                                <option value="all">All Levels</option>
                                <option value="error">Errors</option>
                                <option value="warning">Warnings</option>
                                <option value="info">Info</option>
                            </select>
                        </div>
                    </div>
                    <div class="logs" id="system-logs"></div>
                </div>
            </div>

            <!-- Settings View -->
            <div id="settings-view" class="view">
                <div class="card">
                    <div class="card-header">
                        <h2>Gateway Configuration</h2>
                    </div>
                    <div id="settings-form">
                        <form onsubmit="saveSettings(event)">
                            <div class="form-group">
                                <label>Rate Limit (requests/minute)</label>
                                <input type="number" id="rate-limit" name="rate_limit" min="1" max="1000">
                            </div>
                            <div class="form-group">
                                <label>Max Request Size</label>
                                <select id="max-size" name="max_size">
                                    <option value="1MB">1 MB</option>
                                    <option value="5MB">5 MB</option>
                                    <option value="10MB">10 MB</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Security Mode</label>
                                <select id="security-mode" name="security_mode">
                                    <option value="enforced">Enforced</option>
                                    <option value="monitoring">Monitoring Only</option>
                                    <option value="disabled">Disabled</option>
                                </select>
                            </div>
                            <button type="submit" class="button button-primary">Save Settings</button>
                        </form>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        let darkMode = false;
        let trafficChart = null;
        let resourceChart = null;

        function initCharts() {
            // Traffic Chart
            const trafficCtx = document.getElementById('trafficChart').getContext('2d');
            trafficChart = new Chart(trafficCtx, {
                type: 'line',
                data: {
                    labels: Array(10).fill('').map((_, i) => `${i}m ago`),
                    datasets: [{
                        label: 'Requests/sec',
                        data: Array(10).fill(0),
                        borderColor: '#2563eb',
                        tension: 0.4,
                        fill: false
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    animation: false
                }
            });

            // Resource Chart
            const resourceCtx = document.getElementById('resourceChart').getContext('2d');
            resourceChart = new Chart(resourceCtx, {
                type: 'line',
                data: {
                    labels: Array(10).fill('').map((_, i) => `${i}s ago`),
                    datasets: [{
                        label: 'CPU Usage',
                        data: Array(10).fill(0),
                        borderColor: '#22c55e',
                        tension: 0.4,
                        fill: false
                    }, {
                        label: 'Memory Usage',
                        data: Array(10).fill(0),
                        borderColor: '#f59e0b',
                        tension: 0.4,
                        fill: false
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    animation: false
                }
            });
        }

        function toggleTheme() {
            darkMode = !darkMode;
            document.body.classList.toggle('dark');
        }

        function switchView(viewName) {
            document.querySelectorAll('.view').forEach(view => {
                view.classList.remove('active');
            });
            
            document.getElementById(`${viewName}-view`).classList.add('active');
            
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
            });
            document.querySelector(`[href="#${viewName}"]`).classList.add('active');

            loadViewData(viewName);
        }

        async function loadViewData(viewName) {
            try {
                switch(viewName) {
                    case 'analytics':
                        const analyticsData = await fetch('/analytics').then(r => r.json());
                        updateAnalyticsView(analyticsData);
                        break;
                    case 'security':
                        const securityData = await fetch('/security').then(r => r.json());
                        updateSecurityView(securityData);
                        break;
                    case 'logs':
                        const logsData = await fetch('/logs').then(r => r.json());
                        updateLogsView(logsData);
                        break;
                    case 'settings':
                        const settingsData = await fetch('/settings').then(r => r.json());
                        updateSettingsForm(settingsData);
                        break;
                    default:
                        updateDashboard();
                }
            } catch (error) {
                console.error(`Error loading ${viewName} data:`, error);
                showAlert(`Error loading ${viewName} data`, 'error');
            }
        }

        async function updateMetrics() {
            try {
                const [healthResponse, rootResponse] = await Promise.all([
                    fetch('/health'),
                    fetch('/')
                ]);
                
                const healthData = await healthResponse.json();
                const rootData = await rootResponse.json();
                
                document.getElementById('gateway-metrics').innerHTML = `
                    <div class="metric">
                        <span class="metric-label">
                            <i class="fas fa-clock"></i> Uptime
                        </span>
                        <span class="metric-value">${Math.floor(healthData.system_info.uptime / 3600)}h</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">
                            <i class="fas fa-shield-alt"></i> Security Mode
                        </span>
                        <span class="metric-value">${healthData.security_mode}</span>
                    </div>
                `;

                document.getElementById('system-metrics').innerHTML = `
                    <div class="metric">
                        <span class="metric-label">
                            <i class="fas fa-microchip"></i> CPU Usage
                        </span>
                        <span class="metric-value">${healthData.system_info.cpu_usage}%</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">
                            <i class="fas fa-memory"></i> Memory Usage
                        </span>
                        <span class="metric-value">${healthData.system_info.memory_usage}%</span>
                    </div>
                `;

                updateCharts(healthData);
            } catch (error) {
                console.error('Error fetching metrics:', error);
                showAlert('Error updating metrics', 'error');
            }
        }

        function updateCharts(healthData) {
            trafficChart.data.datasets[0].data.shift();
            trafficChart.data.datasets[0].data.push(Math.random() * 100);
            trafficChart.update();

            resourceChart.data.datasets[0].data.shift();
            resourceChart.data.datasets[0].data.push(healthData.system_info.cpu_usage);
            
            resourceChart.data.datasets[1].data.shift();
            resourceChart.data.datasets[1].data.push(healthData.system_info.memory_usage);
            
            resourceChart.update();
        }

        async function saveSettings(event) {
            event.preventDefault();
            const formData = new FormData(event.target);
            const settings = Object.fromEntries(formData);
            
            try {
                const response = await fetch('/settings', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(settings)
                });
                
                showAlert(response.ok ? 'Settings saved successfully' : 'Error saving settings',
                         response.ok ? 'success' : 'error');
            } catch (error) {
                showAlert('Error saving settings', 'error');
            }
        }

        function showAlert(message, type = 'success') {
            const alert = document.createElement('div');
            alert.className = `alert alert-${type}`;
            alert.textContent = message;
            
            document.querySelector('.main-content').insertBefore(
                alert,
                document.querySelector('.main-content').firstChild
            );

            setTimeout(() => alert.remove(), 3000);
        }

        async function refreshData() {
            const refreshBtn = document.querySelector('.button i.fa-sync');
            refreshBtn.style.transform = 'rotate(360deg)';
            await updateMetrics();
            setTimeout(() => {
                refreshBtn.style.transform = 'rotate(0deg)';
            }, 500);
        }

        // Initialize the dashboard
        document.addEventListener('DOMContentLoaded', () => {
            initCharts();
            updateMetrics();
            setInterval(updateMetrics, 5000);
            
            const initialView = window.location.hash.slice(1) || 'dashboard';
            switchView(initialView);

            window.addEventListener('hashchange', () => {
                const newView = window.location.hash.slice(1);
                switchView(newView);
            });
            
            document.querySelector('.button i.fa-sync').style.transition = 'transform 0.5s ease';
        });
    </script>
</body>
</html>
